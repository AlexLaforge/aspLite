<!doctype html>
<html>
<head>
<meta charset="utf-8" /> 
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<link href="css/style.css" rel="stylesheet" />
<title>AJAX Example</title>
<script src="js/jquery.js"></script>
<script src="js/aspAjax.js"></script>
</head>
<body>
<div  style="background-color:LightYellow;padding:20px 30px" id="hello"></div>

<div style="padding:20px 30px">

	<p>Form 1</p>
	<form class="ajaxForm" id="form1" action="#" method="post">
		<input type="hidden" id="myaction" name="myaction" value="">
		<input type="text" size=35 name="yourname" placeholder="utf8" value="Hello world, Καλημέρα κόσμε, コンニチハ">
		<input onclick="$('#myaction').val('submit1')" type="submit" value="Save">
		<input onclick="$('#myaction').val('delete1')" type="submit" value="Delete">
		<a href="#" onclick="$('#myaction').val('linksubmit');$('#form1').submit()">Submit link</a>
	</form>

	<p>Form 2</p>
	<form class="ajaxForm" action="#" method="post">
		<input type="hidden" id="myaction2" name="myaction" value="">
		<input onclick="$('#myaction2').val('submit2')" type="submit" value="Save">
		<input onclick="$('#myaction2').val('delete2')" type="submit" value="Delete">
	</form>

	<p>Button</p>
	<button class="aspAjax" name="buttonclick" type="button">Click Me!</button>

	<p>Links</p>
	<ul>
		<li><a class="aspAjax" href="#" name="clicklink1">Click a first link</a></li>
		<li><a class="aspAjax" href="#" name="clicklink2">Click a second link</a></li>
		<li><a class="aspAjax" href="#" name="returnbool">Get random boolean from the server</a></li>
	</ul>
	<p>JSON datatable</p>
	<ul>
		<li><a class="aspAjaxData" href="#" name="returnjsondata">Get some JSON data (stored in the database)</a>
		
			<div id="data"></div>
			
		</li>		
	</ul>
	<p><a class="aspAjax" href="#" name="sendmail">Send email</a></p>
	<p><a onclick="$('#data').html('');onPageLoad()" href="#">Reset page</a></p>
	<p><a href="default.asp">Home</a></p>

</div>

<script>

	var aspAjaxUrl='ajax.asp'

	$(document).ready(function(e) {		
		onPageLoad()
	})

	$('.aspAjax').click(function(e) {
		e.preventDefault()
		aspAjax('GET',aspAjaxUrl,'myaction=' + this.name,aspAjaxSuccess)
	})

	$('.ajaxForm').submit(function(e) {
		e.preventDefault()
		aspAjax('POST',aspAjaxUrl,$(this).serialize(),aspAjaxSuccess)
	})
	
	$('.aspAjaxData').click(function(e) {
		e.preventDefault()
		aspAjax('GET',aspAjaxUrl,'myaction=' + this.name,jsonToTable)
	})

	function onPageLoad () { 
		aspAjax('GET',aspAjaxUrl,'myaction=onload',aspAjaxSuccess)	
	}

	function aspAjaxSuccess(data) {
		$('#hello').html(data)	
	}
	
	function jsonToTable(data) {
	
		var persons=JSON.parse(data).persons
		var liPersons=''
			
		if (persons.length==0) {
			$('#data').html('<p>no records found</p>')
			return
		}
		
		for (var i = 0; i < persons.length; i++) {
		
			var person=persons[i]	
		
			for (var key in person) {
				liPersons+='<th>' + key + '</th>'
			}
			
			break	// stop after 1 loop just to get the table headers
		
		}
		
		liPersons='<tr>' + liPersons + '</tr>'	
			
		for (var i = 0; i < persons.length; i++) {
		
			liPersons+='<tr>'
		
			var person=persons[i]
			
			for (var key in person) {
				liPersons+='<td>' + (person[key]) + '</td>'
			}
			
			liPersons+='</tr>'
			
		}
		
		$('#data').html('<br><table cellpadding=10 cellspacing=0 border=1>' + liPersons + '</table>')
		
	}
	

</script>

</body>
</html>