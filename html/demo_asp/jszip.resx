<script src="js/jszip.min.js"></script>
<script src="js/filesaver.min.js"></script>

<p><strong>JSZip</strong> experiment - <a target="_blank" href="https://stuk.github.io/jszip/">https://stuk.github.io/jszip/</a></p>

<button id="blob" class="btn btn-primary">click to download zip</button>

<script>

var zip = new JSZip()
var i=0
var urls = []

$("#blob").on("click", function () {

	$(this).html('please wait... files are downloading')
	
	//the list of files below is generated on the server
	//see code/demo_asp/jszip.asp
[filelist]
	
	getUrl(urls[i][0],urls[i][1])	
		
});

function download() {
	
	$('#blob').html('please wait... files are zipped')

	i=0

	zip.generateAsync({type:"blob"}).then(function (blob) { 
		saveAs(blob, "download.zip")
		
		$('#blob').html('click to download zip')	
		
	}, function (err) {})
}

function getUrl(filename,url) {	
	
	$.ajax({
		url: url,
		type:'GET',
		cache:false,
		xhr:function(){		
				
			var xhr = new XMLHttpRequest();
			
			if (filename==url) {xhr.responseType= 'blob'}
			else {xhr.responseType= 'text'}
				
			return xhr;		
				
		},
		success: function(data){

			if (filename==url) {zip.file(filename, data,{binary: true})}
			else{zip.file(filename, data)}
			
			i++		
			
			if (i==urls.length) {download()}
			else {getUrl(urls[i][0],urls[i][1])}
				
		},
		error:function(){	

			console.log('err: ' + filename)
			
			i++
			
			if (i==urls.length) {download()}
			else {getUrl(urls[i][0],urls[i][1])}				
		}
	})
}

</script>