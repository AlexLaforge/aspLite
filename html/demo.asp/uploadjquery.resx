<p>Select multiple files (jQuery upload):</p>

<form method="post" enctype="multipart/form-data" id="uploadForm" action=""> 
 
	<div class="form-group">
		<div class="custom-file">
		
		<input type="file" class="custom-file-input" name="files" id="files" multiple onchange="$('#uploadForm').submit();return false;">
		<label class="custom-file-label" id="customFileLabel" for="customFile">Choose files</label>

		</div>
	</div>
	
	<div style="display:none" id="alert" class="alert alert-primary" role="alert">
		
		
		<div id="loading" class="spinner-border" style="float:right;width: 1.5rem; height: 1.5rem;" role="status">
		  <span class="sr-only">Loading...</span>		  
		</div>			
		
		<div id="uploadFB"></div>		
	
	</div>
  
</form>

<div class="alert alert-danger" role="alert">
  Security alert: this script uploads the selected file(s) in the /uploads folder. However,
  for obvious security reasons, they are deleted right after. Check /code/demo.asp/uploadfile.resx.
</div>

<script>

var i=0;
var j=0;
var files;

$("#uploadForm").submit(function(e){

	e.preventDefault()
	
	$("#uploadFB").html('<strong>Upload started!</strong> Do not close this window.')
	
	$("#loading").css("display","block");
	$("#alert").css("display","block");
	
	$("#uploadForm").find("input[type=file]").each(function(index, field){
		files=field.files		
		})	
		
	jQueryUpload()
	
});

function jQueryUpload() {	
	
	var file = files[i]
	var fd = new FormData(); 			
	fd.append('file', file)	
	
	$.ajax({		
		type: "post",
		url: "demo.asp?e=uploadfilejquery",
		dataType: "text",
		data: fd,
		contentType: false, 
		processData: false, 
		success: function (data) {			
					$("#uploadFB").html('<strong>' + file.name + '</strong> was uploaded')	
					i++				
					if(i<files.length) {jQueryUpload()}
					else {
					//done	
					finish()
					}
				},
		error: function (data) {
			$("#uploadFB").html('<strong>' + file.name + '</strong> was NOT uploaded')	
			i++
			j++
			if(i<files.length) {jQueryUpload()}
			else {
				//done
				finish()
				}			
			}
		});
	}

function finish() {
	
	$("#loading").css("display","none")
	
	$("#uploadFB").html('<strong>' + (i-j) + ' files</strong> have been uploaded')
	
	if(!j==0) {
		$("#uploadFB").append('<br><strong>' + j + ' files</strong> have NOT been uploaded (probably too big)')
	}
	
	i=0;
	j=0;
}
</script>